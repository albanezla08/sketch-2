<body>
  <div class="seal-container">
  </div>
</body>
<style>
  p {
    position: fixed;
    left: 50%;
    top: 50%;
  }
/* "Pausable gif" effect stolen from Junjun Zhang on https://codepen.io/zjun/pen/dGPqzQ */
  @keyframes like-gif {
    0% {
      background-position: 0%;
    }
    100% {
      background-position: 100%;
    }
  }
  .paused {
    animation-play-state: paused;
  }
  .reversed {
    animation-direction: reverse;
  }
  .seal-container {
    width: 200px;
    height: 207px;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background-image: url("sheet-spinning-seal.png");
    animation-name: like-gif;
    animation-timing-function: steps(34);
    animation-duration: 1.5s;
    animation-iteration-count: infinite;
  }
</style>
<script>

  let previousMousePos;
  let rotationTotal = 0;
  let centerGif;
  let isMouseMoving = false;
  let pauseRequest;
  
  function playGifClockwise () {
    // centerGif.classList.remove('paused');
  }
  function playGifCounterclockwise () {
    centerGif.classList.add('reversed');
    centerGif.classList.remove('paused');
  }
  function pauseGif () {
    centerGif.classList.add('paused');
  }

  /* Stole this function from https://stackoverflow.com/questions/49147241/how-to-detect-if-mouse-is-moving-in-clockwise-direction */
  // cx,cy center of rotation
  // ox,oy old position of mouse
  // mx,my new position of mouse.
  function getAngleBetween(cx, cy, ox, oy, mx, my) {
    const x1 = ox - cx;
    const y1 = oy - cy;
    const x2 = mx - cx;
    const y2 = my - cy;
    // max to prevent div by zero
    const d1 = Math.max(0.001, Math.sqrt(x1 * x1 + y1 * y1));
    const d2 = Math.max(0.001, Math.sqrt(x2 * x2 + y2 * y2));
    return Math.asin((x1 / d1) * (y2 / d2) - (y1 / d1) * (x2 / d2));
  }
  
  /*Credit for clockwise mouse detection logic comes from these two sources*/
  /*https://gamedev.stackexchange.com/questions/158964/detect-how-much-mouse-has-rotated-in-a-circle-around-an-xy-point*/
  /*https://stackoverflow.com/questions/49147241/how-to-detect-if-mouse-is-moving-in-clockwise-direction*/
  function checkAngleChange (event) {
    isMouseMoving = true;
    clearTimeout(pauseRequest);
    const centerX = window.innerWidth / 2;
    const centerY = window.innerHeight / 2;
    const mouseX = event.clientX;
    const mouseY = event.clientY;
    // const angle = Math.atan2(mouseX - centerX, mouseY - centerY);
    const angleDelta = getAngleBetween(centerX, centerY, previousMousePos[0], previousMousePos[1], mouseX, mouseY) * 180 / Math.PI;
    // console.log(angleDelta, angle, previousAngle);
    
    // rotationTotal += angleDelta;
    // console.log("total: ", rotationTotal);

    // previousAngle = angle;
    previousMousePos = [mouseX, mouseY];
    
    console.log(angleDelta);
    
    if (angleDelta > 0.01) {
      playGifClockwise();
      // pauseRequest = setTimeout(5000, pauseGif);
      // requestAnimationFrame(() => {
      //   isMouseMoving = false;
      //   requestAnimationFrame(() => {if (!isMouseMoving) pauseGif()});
      // });
    }
  }
  function setInitialAngle (event) {
    document.removeEventListener('mousemove', setInitialAngle);
    // const centerX = window.innerWidth / 2;
    // const centerY = window.innerHeight / 2;
    const mouseX = event.clientX;
    const mouseY = event.clientY;
    // previousAngle = Math.atan2(mouseX - centerX, mouseY - centerY);
    previousMousePos = [mouseX, mouseY];
    // document.addEventListener('mousemove', checkAngleChange);
  }
  
  function setup () {
    centerGif = document.querySelector('.seal-container');
    document.addEventListener('mousemove', setInitialAngle);
    console.log(centerGif);
  }
  
  window.addEventListener('load', setup);
</script>